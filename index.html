<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
    <title>Document</title>
  </head>
  <body>
    <!-- <form class="form">
      <input type="file" name="fileInp" />
      <input type="text" name="textInp" />
      <button class="add" name="add" type="submit">add</button>
    </form> -->
    <!-- <input type="file" onload="download()" class="inpFile" />
    <button class="addbtn">add</button>
    <div class="images"></div>
    <div class="box" style="width: 100px; height: 100px"></div> -->
    <div style="text-align: center; margin-top: 30px; padding-bottom: 20px">
      <input type="file" id="fileInp" />
      <input type="text" id="textInp" />
      <button id="btn">add</button>
    </div>

    <div
      class="box"
      style="
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        text-align: center;
      "
    ></div>
    <dialog class="editModal">
      <form action="" class="editForm">
        <input type="text" name="nameEdit" id="" />
        <input type="file" name="imgEdit" />
        <button type="submit" class="deitSubmit">+</button>
      </form>
      <button class="editClose">X</button>
    </dialog>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      let API = "http://localhost:3000/data";
      let box = document.querySelector(".box");
      const fileInp = document.getElementById("fileInp");
      const btn = document.getElementById("btn");
      const textInp = document.getElementById("textInp");
      let editModal = document.querySelector(".editModal");
      let editClose = document.querySelector(".editClose");
      let editForm = document.querySelector(".editForm");
      editClose.onclick = () => {
        editModal.close();
      };
      fileInp.addEventListener("change", (e) => {
        let file = e.target.files[0];
        let reader = new FileReader();
        reader.readAsDataURL(file);
        console.log(reader);
        btn.onclick = async (e) => {
          try {
            let { data } = await axios.post("http://localhost:3000/data", {
              img: reader.result,
              name: textInp.value,
            });
            console.log(data);
          } catch (error) {
            console.log(error);
          }
        };
      });

      async function get() {
        try {
          const { data } = await axios.get(API);
          getUser(data);
        } catch (error) {
          console.error(error);
        }
      }

      function editUser(e) {
        editModal.showModal();
        editForm["nameEdit"].value = e.name;
        editForm["imgEdit"].file = e.img;
        editForm["imgEdit"].addEventListener("change", (e) => {
          let editFile = e.target.files[0];
          const reader2 = new FileReader();
          reader2.readAsDataURL(editFile);
          editForm.onsubmit = async (event) => {
            event.preventDefault();
            console.log(reader2.result);

            try {
              let { data } = await axios.put("http://localhost:3000/data", {
                img: reader2.result,
                name: event.target["nameEdit"].value,
              });
              get();
            } catch (error) {
              console.error(error);
            }

            editModal.close();
          };
        });
      }

      function getUser(data) {
        box.innerHTML = "";
        data.forEach((e) => {
          let div = document.createElement("div");
          div.className = "cont";
          let p = document.createElement("span");
          let img = document.createElement("img");
          let div2 = document.createElement("div");
          let btn = document.createElement("button");
          btn.innerHTML = "edit";
          btn.onclick = () => {
            editModal.showModal();
            editUser(e);
          };
          img.src = e.img;
          p.innerHTML = e.name;
          div2.append(p, btn);
          div.append(img, div2);

          box.append(div);
        });
      }
      get();
    </script>
  </body>
</html>
